FROM fedora:latest

RUN dnf update -y \
 && dnf install -y --setopt=install_weak_deps=False \
        wget curl iputils nmap unzip git \
        community-mysql postgresql \
        ca-certificates apt-transport-https gnupg \
 && dnf clean all

# Install AWS Client v2
RUN curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py \
 && python3 get-pip.py \
 && rm -f get-pip.py

RUN curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
 && unzip awscliv2.zip \
 && ./aws/install --update \
 && rm -rf ./aws awscliv2.zip \
 && aws --version

# Install Terraform
ARG TERRAFORM_VERSION=0.12.28
ENV TERRAFORM_FILE=terraform_${TERRAFORM_VERSION}_linux_amd64.zip
RUN wget -q https://releases.hashicorp.com/terraform/${TERRAFORM_VERSION}/${TERRAFORM_FILE} \
 && unzip ${TERRAFORM_FILE} -d /usr/local/bin \
 && rm -rf ${TERRAFORM_FILE}

# Install Kubectl
ARG KUBECTL_VERSION=v1.17.3
RUN wget -q https://storage.googleapis.com/kubernetes-release/release/${KUBECTL_VERSION}/bin/linux/amd64/kubectl \
    --directory-prefix=/usr/local/bin/

# Install Helm
ARG HELM_VERSION=v3.2.4
ENV HELM_FILE=helm-${HELM_VERSION}-linux-amd64.tar.gz
RUN wget -q https://get.helm.sh/${HELM_FILE} \
 && tar -xf ${HELM_FILE} --strip-components=1 -C /usr/local/bin \
 && rm ${HELM_FILE}
